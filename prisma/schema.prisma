// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  SUPER_ADMIN
  SCHOOL_ADMIN
  INSTRUCTOR
  STUDENT
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum LessonStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
}

enum LessonTypeName {
  THEORY
  PRACTICAL
  TEST
}

enum VehicleTypeName {
  LMV
  HMV
  MOTORCYCLE
  BUS
}

model users {
  id           String      @id @default(uuid())
  first_name   String      @db.VarChar(30)
  last_name    String      @db.VarChar(30)
  email        String?     @unique @db.VarChar(100)
  emirates_id  String?     @unique @db.VarChar(20)
  password     String
  phone        String     @db.VarChar(20)
  role         UserRole   
  status       UserStatus  @default(ACTIVE)
  school_id    String?

  school       schools?    @relation(fields: [school_id], references: [id])
  instructor   instructors?
  student      students?

  created_at   DateTime    @default(now())
  updated_at   DateTime    @updatedAt
}

model schools {
  id            String       @id @default(uuid())
  name          String
  trade_license String       @unique
  address       String?

  users         users[]
  instructors   instructors[]
  students      students[]

  created_at    DateTime     @default(now())
}

model instructors {
  id           String      @id @default(uuid())
  user_id      String      @unique
  school_id    String
  license_no   String
  experience   Int

  user         users       @relation(fields: [user_id], references: [id])
  school       schools     @relation(fields: [school_id], references: [id])
  lessons      lessons[]

  created_at   DateTime    @default(now())
}

model students {
  id            String      @id @default(uuid())
  user_id       String      @unique
  school_id     String
  file_no       String      @unique
  nationality   String?

  user          users       @relation(fields: [user_id], references: [id])
  school        schools     @relation(fields: [school_id], references: [id])
  lessons       lessons[]
  payments      payments[]

  created_at    DateTime    @default(now())
}

model lesson_types {
  id    Int             @id @default(autoincrement())
  name  LessonTypeName  @unique

  lessons lessons[]
}

model vehicle_types {
  id    Int             @id @default(autoincrement())
  name  VehicleTypeName @unique

  vehicles vehicles[]
}

model vehicles {
  id               String       @id @default(uuid())
  plate_no         String       @unique
  vehicle_type_id  Int
  model            String?
  transmission     String
  insurance_expiry DateTime
  status           UserStatus

  vehicle_type     vehicle_types @relation(fields: [vehicle_type_id], references: [id])
  lessons          lessons[]

  created_at       DateTime      @default(now())
}

model lessons {
  id            String       @id @default(uuid())
  student_id    String
  instructor_id String
  vehicle_id    String?
  lesson_type_id Int
  scheduled_at  DateTime
  duration_min  Int
  status        LessonStatus  @default(SCHEDULED)

  student       students      @relation(fields: [student_id], references: [id])
  instructor    instructors   @relation(fields: [instructor_id], references: [id])
  vehicle       vehicles?     @relation(fields: [vehicle_id], references: [id])
  lesson_type   lesson_types  @relation(fields: [lesson_type_id], references: [id])

  created_at    DateTime      @default(now())
}

model payments {
  id          String         @id @default(uuid())
  student_id  String
  amount      Decimal
  method      String?
  status      PaymentStatus  @default(PENDING)

  student     students       @relation(fields: [student_id], references: [id])

  created_at  DateTime       @default(now())
}

