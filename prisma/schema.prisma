generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  SUPER_ADMIN
  MANAGER
  ADMIN
  INSTRUCTOR
  STUDENT
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum LessonStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
}

enum LessonTypeName {
  THEORY
  PRACTICAL
  TEST
}

enum VehicleTypeName {
  LMV
  HMV
  MOTORCYCLE
  BUS
}

enum SchoolStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum SchoolType {
  LIGHT_VEHICLE      
  MOTORCYCLE         
  HEAVY_VEHICLE      
  COMBINED           
  ALL_CATEGORIES     
}


model User {
  id          String      @id @default(uuid())
  firstName   String      @db.VarChar(30) @map("first_name")
  lastName    String      @db.VarChar(30) @map("last_name")
  email       String?     @unique @db.VarChar(100)
  emiratesId  String?     @unique @db.VarChar(20) @map("emirates_id")
  password    String
  phone       String      @unique @db.VarChar(20)
  role        UserRole
  status      UserStatus  @default(ACTIVE)
  schools     UserSchool[]
  instructor  Instructor?
  student     Student?

  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")

  @@map("users")
}

model School {
  id                   String             @id @default(uuid())
  name                 String
  tradeLicense         String             @unique @map("trade_license")
  tradeLicenseExpiry   DateTime           @map("trade_license_expiry")
  schoolType           SchoolType         @map("school_type")
  address              String
  city                 String
  country              String
  status               SchoolStatus       @default(ACTIVE)
  phone                String            

  users                UserSchool[]
  instructors          InstructorSchool[]
  students             StudentSchool[]

  createdAt            DateTime           @default(now()) @map("created_at")

  @@map("schools")
}


model Instructor {
  id         String     @id @default(uuid())
  userId     String     @unique @map("user_id")
  licenseNo  String     @map("license_no")
  licenseExpiryDate     DateTime  @map("license_expiry_date")
  experience Int

  user       User       @relation(fields: [userId], references: [id])
  schools    InstructorSchool[]
  students   StudentInstructor[]

  createdAt  DateTime   @default(now()) @map("created_at")

  @@map("instructors")
}

model Student {
  id          String       @id @default(uuid())
  userId      String       @unique @map("user_id")
  trafficCode       String? @map("traffic_code")

  user        User         @relation(fields: [userId], references: [id])
  schools     StudentSchool[]
  instructors StudentInstructor[]

  createdAt   DateTime     @default(now()) @map("created_at")

  @@map("students")
}

/// Join tables

model UserSchool {
  id        String   @id @default(uuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String   @map("user_id")
  school    School   @relation(fields: [schoolId], references: [id])
  schoolId  String   @map("school_id")

  assignedAt DateTime @default(now()) @map("assigned_at")

  @@unique([userId, schoolId])
  @@map("user_schools")
}

model InstructorSchool {
  id           String     @id @default(uuid())
  instructor   Instructor @relation(fields: [instructorId], references: [id])
  instructorId String     @map("instructor_id")
  school       School     @relation(fields: [schoolId], references: [id])
  schoolId     String     @map("school_id")

  assignedAt   DateTime   @default(now()) @map("assigned_at")

  @@unique([instructorId, schoolId])
  @@map("instructor_schools")
}

model StudentSchool {
  id        String   @id @default(uuid())
  student   Student  @relation(fields: [studentId], references: [id])
  studentId String   @map("student_id")
  school    School   @relation(fields: [schoolId], references: [id])
  schoolId  String   @map("school_id")

  enrolledAt DateTime @default(now()) @map("enrolled_at")

  @@unique([studentId, schoolId])
  @@map("student_schools")
}

model StudentInstructor {
  id           String      @id @default(uuid())
  student      Student     @relation(fields: [studentId], references: [id])
  studentId    String      @map("student_id")
  instructor   Instructor  @relation(fields: [instructorId], references: [id])
  instructorId String      @map("instructor_id")

  assignedAt   DateTime    @default(now())

  @@unique([studentId, instructorId])
  @@map("student_instructors")
}



