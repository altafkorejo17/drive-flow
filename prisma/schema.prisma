// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}


enum user_status {
  ACTIVE
  INACTIVE
}

enum institute_status {
  ACTIVE
  INACTIVE
}

enum student_status {
  ACTIVE
  COMPLETED
  DROPPED
}

enum specialization {
  THEORY
  PRACTICAL
  BOTH
}

model user {
  id            Int      @id @default(autoincrement()) @map("id")
  full_name     String   @map("full_name")
  email         String   @unique @map("email")
  phone         String?  @map("phone")
  password      String   @map("password")
  status        user_status @default(ACTIVE) @map("status")
  created_at    DateTime @default(now()) @map("created_at")

  roles         user_role[]
  institutes    user_institute[]
  instructor    instructor?
  student       student?

  @@map("users")
}

model role {
  id     Int    @id @default(autoincrement()) @map("id")
  name   String @unique @map("name")

  users  user_role[]

  @@map("roles")
}

model user_role {
  id      Int @id @default(autoincrement()) @map("id")
  user_id Int @map("user_id")
  role_id Int @map("role_id")

  user    user @relation(fields: [user_id], references: [id])
  role    role @relation(fields: [role_id], references: [id])

  @@unique([user_id, role_id])
  @@map("user_roles")
}

model institute {
  id             Int    @id @default(autoincrement()) @map("id")
  name           String @map("name")
  license_number String @map("license_number")
  emirate        String @map("emirate")
  status         institute_status @default(ACTIVE) @map("status")

  users        user_institute[]
  instructors  instructor[]
  students     student[]

  @@map("institutes")
}

model user_institute {
  id           Int @id @default(autoincrement()) @map("id")
  user_id      Int @map("user_id")
  institute_id Int @map("institute_id")

  user        user      @relation(fields: [user_id], references: [id])
  institute   institute @relation(fields: [institute_id], references: [id])

  @@unique([user_id, institute_id])
  @@map("user_institutes")
}

model instructor {
  id             Int @id @default(autoincrement()) @map("id")
  user_id        Int @unique @map("user_id")
  institute_id   Int @map("institute_id")
  license_number String @map("license_number")
  license_expiry DateTime @map("license_expiry")
  specialization specialization @map("specialization")

  user       user      @relation(fields: [user_id], references: [id])
  institute  institute @relation(fields: [institute_id], references: [id])

  @@map("instructors")
}

model student {
  id           Int @id @default(autoincrement()) @map("id")
  institute_id Int @map("institute_id")
  user_id      Int? @unique @map("user_id")
  emirates_id  String @unique @map("emirates_id")
  status       student_status @default(ACTIVE) @map("status")

  user       user?      @relation(fields: [user_id], references: [id])
  institute  institute  @relation(fields: [institute_id], references: [id])

  @@map("students")
}