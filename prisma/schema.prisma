generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  SUPER_ADMIN
  MANAGER
  ADMIN
  INSTRUCTOR
  STUDENT
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum LessonStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
}

enum LessonTypeName {
  THEORY
  PRACTICAL
  TEST
}

enum VehicleTypeName {
  LMV
  HMV
  MOTORCYCLE
  BUS
}

enum SchoolStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum SchoolType {
  LIGHT_VEHICLE      
  MOTORCYCLE         
  HEAVY_VEHICLE      
  COMBINED           
  ALL_CATEGORIES     
}

model User {
  id          String      @id @default(uuid())
  firstName   String      @db.VarChar(30) @map("first_name")
  lastName    String      @db.VarChar(30) @map("last_name")
  email       String?     @unique @db.VarChar(100)
  emiratesId  String?     @unique @db.VarChar(20) @map("emirates_id")
  password    String
  phone       String      @unique @db.VarChar(20)
  role        UserRole
  status      UserStatus  @default(ACTIVE)

  instructor  Instructor?  // One-to-one if user is an instructor
  student     Student?     // One-to-one if user is a student

  // Many-to-many relations
  schools     UserSchool[]
  instructors UserInstructor[]

  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")

  @@map("users")
}

model School {
  id                 String       @id @default(uuid())
  name               String
  tradeLicense       String       @unique @map("trade_license")
  tradeLicenseExpiry DateTime     @map("trade_license_expiry")
  schoolType         SchoolType   @map("school_type")
  address            String
  city               String
  country            String
  status             SchoolStatus @default(ACTIVE)
  phone              String

  // Many-to-many relations
  users              UserSchool[]

  createdAt          DateTime     @default(now()) @map("created_at")
  updatedAt          DateTime     @updatedAt @map("updated_at")

  @@map("schools")
}

model Instructor {
  id                 String       @id @default(uuid())
  userId             String       @unique @map("user_id")  // One-to-one with User
  licenseNo          String       @map("license_no")
  licenseExpiryDate  DateTime     @map("license_expiry_date")
  experience         Int

  // Relations
  user               User         @relation(fields: [userId], references: [id])
  users              UserInstructor[] 
  
  createdAt          DateTime     @default(now()) @map("created_at")
  updatedAt          DateTime     @updatedAt @map("updated_at")

  @@map("instructors")
}

model Student {
  id          String   @id @default(uuid())
  userId      String   @unique @map("user_id")
  trafficCode String?  @map("traffic_code")

  // Relations
  user        User     @relation(fields: [userId], references: [id])

  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("students")
}

// ----------------------------
// Join Tables
// ----------------------------

/// User ↔ School (many-to-many)
model UserSchool {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  schoolId  String   @map("school_id")

  user      User     @relation(fields: [userId], references: [id])
  school    School   @relation(fields: [schoolId], references: [id])

  assignedAt DateTime @default(now()) @map("assigned_at")

  @@unique([userId, schoolId])
  @@map("user_schools")
}

/// User ↔ Instructor (many-to-many)
model UserInstructor {
  id           String     @id @default(uuid())
  userId       String     @map("user_id")
  instructorId String     @map("instructor_id")

  user         User       @relation(fields: [userId], references: [id])
  instructor   Instructor @relation(fields: [instructorId], references: [id])

  assignedAt   DateTime   @default(now()) @map("assigned_at")

  @@unique([userId, instructorId])
  @@map("user_instructors")
}





